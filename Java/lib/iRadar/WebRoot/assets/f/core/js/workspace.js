$(function(){var b=window.ctxpath||"";var g=new function(){var h,k;function j(m,l,o){if(!m){return}var n=false;l=l.toLowerCase();$.each(m,function(){var q=(o!==undefined)?o:!(this.text.toLowerCase().indexOf(l)==-1);var p=j(this.children,l,q?true:undefined);if(p){q=true}if(q){n=true}$("#"+this.domId)[q?"show":"hide"]()});return n}var i=function(n){var l=e.currentTree();if(l){var m=l.data("tree");if(m){j(m.data,n)}}};this.filter=function(l){$(l).placeholder().monitor(i)};this.collapse=function(l){$(l).click(function(){d.changeNav("menu")})};this.expand=function(l){$(l).click(function(){d.changeNav("tree")})}};var e=new function(){var n=$("#JS_layoutWest>.west_tree");var k=n.children(".body");var q=n.find(".title");var h=q.attr("class");var p=null;g.filter(n.find(".cmds INPUT"));var j=n.find(".cmds .collapse");g.collapse(j);function o(r){return f.navData(r)}var m={build:function(t){var s=this;var r=$("<DIV />").attr("url",t.url);r.tree=function(w,z){var y=$(this);if(w=="select"){var v=o(this);var x=v.data.name;var u=y.attr("url");if(!u){return}$.workspace.openTab(x,b+u,{id:"",navObj:t})}};return r},initShow:function(r){r.tree("select")},beforeShow:function(){if(p){var r=p.tree("getSelected");if(r){$(r.target).removeClass("tree-node-selected")}}}};var i=$.extend({},m,{build:function(u){var t=this;var r="home";var s=$("<DIV />").data(r,u.data);s.tree=function(x,B){var A=$(this);if(x=="select"){var w=o(this);var y=A.data(r);var z=y.title;var v=y.url;if(!v){return}$.workspace.openTab(z,b+v,{id:"",navObj:w},true)}};return s}});var l={build:function(s){var r=$("<UL />");r.tree($.extend({onSelect:function(v){var y=$(this);var w=y.tree("getData",v.target);var u=w.href;if(!u){return}var z=w.domId;var x=w.text;var t=o(y);$.workspace.openTab(x,b+u,{id:z,oid:w.id,navObj:t})},loader:function(A,z,u,y){var x=$(this);var w=x.tree("options");var t=null;if(y){t=y.url;if(!t){var v=y;while(true){v=x.tree("getParent",v.target);if(!v){break}t=v.url;if(t){break}}}}if(!t){t=w.url}if(!t){return u.apply(this,arguments)}$.ajax({type:w.method,url:b+t,data:A,dataType:"json",success:function(B){z(B)},error:function(){u.apply(this,arguments)}})}},s));return r},initShow:function(r){var u=null;var s=r.tree("options").initial;if(s){u=r.tree("find",s)}if(!u){function t(w){var y=w.target;if(r.tree("isLeaf",y)){return w}else{var x=r.tree("getChildren",y);var v;$.each(x,function(){v=t(this);if(v){return false}});return v}}u=t(r.tree("getRoot"))}if(u){r.tree("select",u.target)}},beforeShow:function(r){if(p){p.hide().inactiveTopNav()}p=r;s=f.navData(r.show().activeTopNav());var u=s.data;var t=[h,u.clazz].join(" ");q.text(u.name).attr("class",t);var s=o(r);if(s.navs.menu.data("changeNav")=="tree"){j.hide()}else{j.show()}},onSelect:function(s,u){var x=u.id;if(!x){return}var w=s.tree("getSelected");if(w&&w.target.id==x){return}var v=$("#"+x,k);var r=f.current().selectData;if(r&&r.id!=x){s.tree("select",v);s.tree("scrollTo",v)}else{var t="tree-node-selected";if(w){$(w.target).removeClass(t)}$(v).addClass(t)}}};this.types={nodata:m,tree:l,home:i,nomenu:m};this.ctn=k;this.currentTree=function(){return k.children("UL:visible")}};var a=new function(){var n=$("#JS_layoutWest>.west_menu");var k=n.children(".body");var p=null;var s="menu";var h="active";g.expand(n.find(".cmds .expand"));function o(u){return f.navData(u)}function j(){var w=$(this).data(s);var v=w.href;if(!v){return}var y=w.domId;var x=w.text;var u=o(w.dom);$.workspace.openTab(x,b+v,{id:y,oid:w.id,navObj:u})}var m={build:function(w){var v=[];function y(B,A){B.map[A]=1;while(B.parent){B=B.parent;B.map[A]=1}}function z(B,A){if(!B){return A}$.each(B,function(){var C=$.extend({},this);C.parent=A.parent;C.map={};var D=[];D.parent=C;y(C,this.id);if(this.url||(z(this.children,D).over)){A.over=true;return false}C.children=D;A.push(C)});return A}z(w.data,v);if(v.over){return null}function u(B,A){$.each(B.children,function(){this.dom=x;var D=$("<DIV />").appendTo(A);D.data(s,this);var C=this.children;if(C){$("<span />").text(this.text).appendTo(D);u(this,D)}else{D.text(this.text)}})}var x=$("<DIV />");$.each(v,function(){this.dom=x;var A=$("<A />").text(this.text).addClass(this.iconCls).attr("href","javascript:void(0)").appendTo(x).data(s,this).click(j);var B=null;if(this.children.length>0){var B=$("<DIV />").appendTo("BODY");u(this,B)}A.menubutton({menu:B});if(B){B.menu("options").onShow=function(){var C=$(this);if(C.hasClass("menu-top")){var D=C.offset();C.css({top:D.top-55,left:D.left+70});var E=C.next(".menu-shadow").first();D=E.offset();E.css({top:D.top-55,left:D.left+70})}}}});return x},initShow:function(u){t("tree","initShow",u)},beforeShow:function(u){if(p){p.hide()}p=u.show();t("tree","beforeShow",u)},onSelect:function(v,u){var w=u.oid;if(!w){return}$("A",v).each(function(){var y=$(this).removeClass(h);var x=y.data(s);if(x.map[w]){y.addClass(h)}})}};var q=m.build;m.build=function(){return q.apply(this,arguments)||new function(){return $("<DIV />").data("changeNav","tree")}};var t=function(v,w,x){var u=o(x).navs.tree;return e.types[v][w](u)};var l=function(v){var u=e.types[v];return u};var r=l("home");var i=r.beforeShow;r.beforeShow=function(u){i.apply(this,arguments);if(p){$("A",p).removeClass(h)}};this.types={nodata:l("nodata"),tree:m,home:r,nomenu:l("nomenu")};this.ctn=k;this.currentTree=function(){return k.children("DIV:visible")}};var d=new function(){var j=$("BODY");var r=$("#JS_layoutWest");var i=r.width();var p;var q={tree:e,menu:a};var n=["beforeShow","initShow","onSelect"];var o="tree";var h=[];function m(){p=p||j.layout("panel","west").parent();return p}function k(s){var u=j.layout("panel","west");if(u.length==0){return}var t=u.panel("options");t.width=s;t.minWidth=0;j.layout("resize")}this.show=function(){if(!p||p.length==0){r.removeClass("vhide");j.layout("add",{region:"west",split:0,el:r})}else{m().show()}k(i)};this.hide=function(){m().hide();k(0)};this.curMenu=function(){return q[o]};var l=this.changeNav=function(u){if(u==o){return}var t=q[o];var s=f.navData(t.currentTree());t.ctn.parent().hide();var v=q[u].ctn.parent().show().width();o=u;f.refresh(s);k(v)};this.buildNavs=function(v){var u={};var t=v.type;$.each(q,function(z,y){var x=y.types[t];var w=y.ctn;u[z]=x.build(v).hide().appendTo(w)});var s={index:h.length,navs:u};$.each(n,function(){var w=this;s[w]=function(){var y=this;var C=q[o].types[y.cfg.type];var A=C[w];if(A){var B=y.navs[o];var z=B.data("changeNav");if(!z){var x=$.makeArray(arguments);x.unshift(B);return A.apply(C,x)}else{l(z);arguments.callee.call(y)}}}});h.push(s);return s}};var f=new function(){var h="_menu";var k="active";var i=this;var j=null;this.build=function(l){var n=l.text();var m=l.attr("class");var p=l.data("menu");p=p||{type:"nodata",data:null};var o=d.buildNavs(p);$.extend(o,{cfg:p,data:{name:n,clazz:m,navDom:l},updateTopNav:function(q){this.data.navDom[q?"addClass":"removeClass"](k)}});$.each(o.navs,function(q,r){r.data(h,o).addClass(p.cls);$.extend(r,{activeTopNav:function(){f.navData(this).updateTopNav(true);return this},inactiveTopNav:function(){f.navData(this).updateTopNav(false);return this}})});return o};this.select=function(n,m,o){var l=null;if(!n||j===n){l=j}else{if(j){j.selectData=null}l=j=n}j.selectData=o;if(l==n){n.beforeShow()}if(m&&l){n.initShow()}if(o){n.onSelect(o)}return l};this.refresh=function(l){var m=l||this.current();return this.select(m,false,m.selectData)};this.current=function(){return j};this.navData=function(l){return l.data(h)}};var c=new function(){var s="data_key_tab_needfresh";var o=19;var k="<iframe src='{0}' scrolling='{2}' frameborder='0' style='width:{1}px;height:100%;'></iframe>";var i=($.browser.msie&&!window.outerHeight);var u=function(y){var x=$(y).tabs("tabs");var w=x.length-1;$.each(x,function(z){var A=$(this).panel("options").tab;A.removeClass(q);A.removeClass(v);if(z==0){A.addClass(v)}if(z==w){A.addClass(q)}})};var p=$("#JS_contentTab").tabs({border:false,fit:true,plain:true,onSelect:function(z,w){var x=$(this).tabs("tabs");$.each(x,function(A){$(this).panel("options").tab.css("zIndex",999-A)});var y=$(x[w]).panel("options").tab;y.css("zIndex",1000);u(this)},onAdd:function(x,w){u(this)},onClose:function(x,w){u(this)}});var t=p.children(".tabs-panels");var r=i?0:(t.outerWidth()-t.width());var l=-r;var h=p.width()+l-o;var q="last";var v="first";function j(B,x){var w={tabTitle:B,url:x};var A=w.tabTitle?p.tabs("getTab",w.tabTitle):p.tabs("getSelected");if(A&&A.find("iframe").length>0){var y=A.find("iframe")[0];var z=w.url?w.url:y.src;y.contentWindow.location.href=z}}function m(z,y,w,x){p.tabs("add",{menu:z,title:y,content:$.stringFormat(k,w,h,i?"yes":"no"),closable:x,onBeforeDestroy:function(){var C=$("iframe",this);try{if(C.length>0){var A=C[0];A.contentWindow.document.write("");A.contentWindow.close();C.remove();if($.browser.msie){CollectGarbage()}}}catch(B){}},onOpen:function(){var B=$.data(this,"panel").options;z=B.menu;if(!z){return}var C=z.id;var A=z.navObj;$(this).data(s,false);f.select(A,false,z);$(this).data(s,true)},onResize:function(A,B){$("iframe",this).css({width:A+l})}})}var n=function(E,w,z,C,B){var y=6;if(p.tabs("exists",E)){p.tabs("select",E);if(B===undefined){var x=p.tabs("getSelected");B=($(x).data(s)!==false)}if(B){j(E,w)}}else{var D=p.tabs("tabs");if(D.length>=y){var A=y-1;var x=D[A];p.tabs("update",{tab:x,options:{menu:z,title:E}});p.tabs("select",A);$("iframe",x)[0].contentWindow.location.href=w}else{m(z,E,w,!C)}}};return{addTab:m,openTab:n,current:function(){return p.tabs("getSelected")}}};$.workspace=new function(){var h=$("#JS_mainNav");var k="DATA_KEY_MENU";var j=h.data("initial");var l=j.nav;var i=$("<DIV />").data("menu",{type:"home",data:j.home});$("A",h).add(i).each(function(){var m=$(this);var n=f.build($(this));m.data(k,n);if(m.hasClass(l)){f.select(n)}}).click(function(){var m=$(this);var n=m.data(k);f.select(n,true)});$.delay(0,function(){i.click()});return{openTab:function(q,m,p,n,o){return c.openTab(q,m,p,n,o)},tabFrameOnLoad:function(p){var o=c.current();if(!o){return}var r=$("iframe",o);if(r.length>0){var q=p.outerHeight||0;var m=p.document.body.scrollHeight||0;var n=Math.max(q,m);$(r).css("height",n)}}}}});